{"remainingRequest":"/Users/peeterkaju/test/space-travel/node_modules/vue-loader-v16/dist/index.js??ref--1-1!/Users/peeterkaju/test/space-travel/src/views/ResultsPage.vue?vue&type=style&index=0&id=2b8be4db&lang=css","dependencies":[{"path":"/Users/peeterkaju/test/space-travel/src/views/ResultsPage.vue","mtime":1703734850843},{"path":"/Users/peeterkaju/test/space-travel/node_modules/css-loader/dist/cjs.js","mtime":1702295033230},{"path":"/Users/peeterkaju/test/space-travel/node_modules/vue-loader-v16/dist/stylePostLoader.js","mtime":1702295033476},{"path":"/Users/peeterkaju/test/space-travel/node_modules/postcss-loader/src/index.js","mtime":1702295033302},{"path":"/Users/peeterkaju/test/space-travel/node_modules/cache-loader/dist/cjs.js","mtime":1702295033100},{"path":"/Users/peeterkaju/test/space-travel/node_modules/vue-loader-v16/dist/index.js","mtime":1702295033302}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CnRhYmxlIHsKICAgIG91dGxpbmU6IDFweCBzb2xpZCBibGFjazsKICAgIG91dGxpbmUtb2Zmc2V0OiAycHg7CiAgICB3aWR0aDogMTAwJTsKICAgIG1heC13aWR0aDogMTAwMHB4OwogICAgdGFibGUtbGF5b3V0OiBmaXhlZDsKfQoKdGQgewogICAgYm9yZGVyOiAxcHggc29saWQgYmxhY2s7CiAgICBwYWRkaW5nOiAzcHg7CiAgICBvdmVyZmxvdzogaGlkZGVuOwogICAgdGV4dC1vdmVyZmxvdzogZWxsaXBzaXM7CiAgICB3aGl0ZS1zcGFjZTogbm93cmFwOwogICAgcG9zaXRpb246IHJlbGF0aXZlOwp9Cgp0aCB7CiAgICBib3JkZXI6IDFweCBzb2xpZCBibGFjazsKICAgIHBhZGRpbmc6IDNweDsKfQoKLnNlYXJjaC1mb3JtLWFyZWEgewogICAgZGlzcGxheTogZmxleDsKICAgIGp1c3RpZnktY29udGVudDogY2VudGVyOwogICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgIGJhY2tncm91bmQtY29sb3I6IHJnYigyOCwgNDgsIDc5KTsKfQoKLmluZm8gewogICAgZGlzcGxheTogZmxleDsKICAgIGZsZXgtZGlyZWN0aW9uOiByb3c7CiAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsKfQoKLmluZm8gcCB7CiAgICBwYWRkaW5nOiAxMHB4Owp9CgouYmlnLWRpdiB7CiAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsKICAgIG1hcmdpbi1ib3R0b206IDIwcHg7Cn0KCi50YWJsZS1kaXYgewogICAgZGlzcGxheTogZmxleDsKICAgIGp1c3RpZnktY29udGVudDogY2VudGVyOwp9Cgouc29ydGluZy1vcHRpb25zIHsKICAgIGRpc3BsYXk6IGZsZXg7CiAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsKICAgIG1hcmdpbi1ib3R0b206IDIwcHg7Cn0KCi5maWx0ZXJpbmctb3B0aW9ucyB7CiAgICBkaXNwbGF5OiBmbGV4OwogICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7CiAgICBtYXJnaW4tYm90dG9tOiAyMHB4OwogICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKfQoKLnVzZXItb3B0aW9ucyB7CiAgICBkaXNwbGF5OiBmbGV4OwogICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7Cn0K"},{"version":3,"sources":["/Users/peeterkaju/test/space-travel/src/views/ResultsPage.vue"],"names":[],"mappings":"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","file":"/Users/peeterkaju/test/space-travel/src/views/ResultsPage.vue","sourceRoot":"","sourcesContent":["<template>\n    <div class=\"search-form-area\">\n        <SearchForm></SearchForm>\n    </div>\n    <div class=\"big-div\">\n        <div class=\"info\">\n            <p>From: {{ from }}</p>\n            <p>Destination: {{ destination }}</p>\n            <p>Distance: {{ distance }}</p>\n            <p>Valid Until: {{ validUntil }}</p>\n        </div>\n        <div class=\"user-options\">\n            <div class=\"sorting-options\">\n                <label>\n                    Sort by:\n                    <select v-model=\"sortOption\" @change=\"sortTravelOptions\">\n                        <option value=\"duration\">Duration</option>\n                        <option value=\"price\">Price</option>\n                    </select>\n                </label>\n            </div>\n            <div class=\"filtering-options\">\n                <label>\n                    Filter by:\n                </label>\n                <custom-dropdown :options=\"uniqueCompanies\" @input=\"filterTravelOptions\"></custom-dropdown>\n\n            </div>\n        </div>\n        <div class=\"table-div\">\n            <table>\n                <thead>\n                    <tr>\n                        <th>Providers</th>\n                        <th>Start Time</th>\n                        <th>Duration</th>\n                        <th>End Time</th>\n                        <th>Price</th>\n                    </tr>\n                </thead>\n                <tbody>\n                    <tr v-for=\"(option, index) in filteredTravelOptions\" :key=\"index\">\n                        <td class=\"provider-data\" @mouseover=\"showTooltip(index, $event, `provider`)\"\n                            @mouseout=\"hideTooltip\">\n                            {{\n                                Array.from(new Set(option.providers.map(provider => provider.companyName))).join(', ')\n                            }}\n                        </td>\n                        <td class=\"time-data\">{{ option.FlightStart }}</td>\n                        <td class=\"duration-data\" @mouseover=\"showTooltip(index, $event, `duration`)\"\n                            @mouseout=\"hideTooltip\">\n                            {{ option.totalDuration }}\n                        </td>\n                        <td class=\"time-data\">{{ option.FlightEnd }}</td>\n                        <td class=\"price-data\">{{ option.totalPrice }}</td>\n                        <button @click=\"openBookingModal(index)\" ref=\"bookingButton\">Book</button>\n                    </tr>\n                </tbody>\n            </table>\n            <Tooltip :text=\"fullText\" :showTooltip=\"tooltipVisible && hoveredIndex === hoveredIndex\"\n                :position=\"tooltipPosition\" />\n        </div>\n    </div>\n    <booking-modal :is-open=\"isBookingModalOpen\" :booking-details=\"bookingDetails\" @confirm=\"confirmBooking\"\n        @cancel=\"cancelBooking\" ref=\"bookingModal\"></booking-modal>\n</template>\n\n<script>\nimport SearchForm from '../components/SearchForm.vue';\nimport Tooltip from '../components/ToolTip.vue';\nimport CustomDropdown from '../components/CustomDropdown.vue';\nimport BookingModal from '../components/BookingModal.vue';\n\nexport default {\n    components: {\n        SearchForm,\n        Tooltip,\n        CustomDropdown,\n        BookingModal,\n    },\n    data() {\n        return {\n            from: \"\",\n            destination: \"\",\n            travelOptions: [],\n            distance: 0,\n            validUntil: null,\n            hoveredIndex: null,\n            tooltipVisible: false,\n            tooltipPosition: {},\n            fullText: '',\n            sortOption: 'duration',\n            selectedCompanies: [],\n            isBookingModalOpen: false,\n            pricelistID: '',\n\n            bookingDetails: {\n                companyNames: [],\n                startTime: '',\n                firstName: '',\n                lastName: '',\n                totalPrice: 0,\n                totalDuration: '',\n                pricelistID: '',\n                routes: [],\n                from: '',\n                destination: '',\n            },\n        };\n    },\n    beforeMount() {\n        this.from = this.$route.query.from;\n        this.destination = this.$route.query.destination || \"DefaultDestination\";\n        this.fetchFlights();\n    },\n    computed: {\n        uniqueCompanies() {\n            const companies = new Set();\n            this.travelOptions.forEach(option => {\n                option.providers.forEach(provider => {\n                    companies.add(provider.companyName);\n                });\n            });\n            return Array.from(companies);\n        },\n        filteredTravelOptions() {\n            if (this.selectedCompanies.length === 0) {\n                return this.travelOptions;\n            } else {\n                return this.travelOptions.filter(option => {\n                    const companyNames = option.providers.map(provider => provider.companyName);\n                    return this.selectedCompanies.some(company => companyNames.includes(company));\n                });\n            }\n        },\n    },\n    methods: {\n        async fetchFlights() {\n            console.log(\"fetching\");\n            const response = await fetch(`http://localhost:8080/api/get/${this.from}/${this.destination}`);\n\n            if (!response.ok) {\n                this.$router.push({ name: \"routeNotFound\" });\n                return;\n            }\n\n            const data = await response.json();\n            console.log(data);\n\n            const formattedProviders = data.possibleRoutes.map(leg => {\n                return {\n                    ...leg,\n                    FlightStart: this.formatDate(leg.providers[0].flightStart),\n                    FlightEnd: this.formatDate(leg.providers[leg.providers.length - 1].flightEnd),\n                };\n            });\n            this.travelOptions = [...this.travelOptions, ...formattedProviders];\n            this.distance = data.totalDistance;\n            this.validUntil = this.formatDate(data.validUntil);\n            this.pricelistID = data.pricelistID;\n            this.sortTravelOptions();\n        },\n\n        formatDate(dateTimeString) {\n            const parts = dateTimeString.split(/[-T:.Z]/);\n            const date = new Date(\n                Date.UTC(parts[0], parts[1] - 1, parts[2], parts[3], parts[4], parts[5])\n            );\n            return date.toLocaleString(\"en-GB\"); // Adjust the locale as needed\n        },\n        showTooltip(index, event, type) {\n            this.hoveredIndex = index;\n            if (type === 'duration') {\n                this.fullText = `${this.filteredTravelOptions[index].totalDuration}`;\n            } else {\n                this.fullText = Array.from(new Set(this.filteredTravelOptions[index].providers.map(provider => provider.companyName))).join(', ');\n            }\n            this.tooltipVisible = true;\n            this.updateTooltipPosition(event);\n            window.addEventListener('mousemove', this.updateTooltipPosition);\n        },\n        hideTooltip() {\n            this.tooltipVisible = false;\n            this.hoveredIndex = null;\n            this.fullText = '';\n            // Remove event listener\n            window.removeEventListener('mousemove', this.updateTooltipPosition);\n        },\n        updateTooltipPosition(event) {\n            const hoveredElement = event.target;\n            const hoveredElementRect = hoveredElement.getBoundingClientRect();\n\n            const topOffset = hoveredElementRect.top;\n\n            this.tooltipPosition = {\n                x: event.pageX + 10,\n                y: topOffset + 10,\n            };\n        },\n        sortTravelOptions() {\n            if (this.sortOption === 'duration') {\n                this.travelOptions.sort((a, b) => this.compareDurations(a.totalDuration, b.totalDuration));\n            } else if (this.sortOption === 'price') {\n                this.travelOptions.sort((a, b) => a.totalPrice - b.totalPrice);\n            }\n        },\n        compareDurations(durationA, durationB) {\n            const parseDuration = (duration) => {\n                const parts = duration.split(', ')\n                    .map(part => part.split(' '))\n                    .map(([value, unit]) => ({ value: parseInt(value), unit }));\n\n                return parts.reduce((acc, { value, unit }) => {\n                    if (unit === 'days') {\n                        acc += value * 24 * 60; // Convert days to minutes\n                    } else if (unit === 'hours') {\n                        acc += value * 60; // Convert hours to minutes\n                    } else if (unit === 'minutes') {\n                        acc += value;\n                    }\n                    return acc;\n                }, 0);\n            };\n\n            const durationAInMinutes = parseDuration(durationA);\n            const durationBInMinutes = parseDuration(durationB);\n\n            return durationAInMinutes - durationBInMinutes;\n        },\n        filterTravelOptions(selectedCompanies) {\n            this.selectedCompanies = Array.from(selectedCompanies)\n            this.selectedCompanies.shift();\n        },\n        openBookingModal(index) {\n            const selectedOption = this.filteredTravelOptions[index];\n\n            this.bookingDetails = {\n                companyNames: selectedOption.providers.map(provider => provider.companyName),\n                startTime: selectedOption.providers[0].flightStart,\n                firstName: '',\n                lastName: '',\n                totalPrice: parseFloat(selectedOption.totalPrice),\n                totalDuration: selectedOption.totalDuration,\n                pricelistID: this.pricelistID,\n                routes: {\n                    from: this.from,\n                    destination: this.destination,\n                },\n                validUntil: this.validUntil,\n            };\n            this.isBookingModalOpen = true;\n        },\n        handleDocumentClick(event) {\n            const bookingModalElement = this.$refs['bookingModal'].$el;\n            const bookingButtonElem = this.$refs['bookingButton'];\n            if (bookingButtonElem.some(button => button.contains(event.target))) {\n                return;\n            }\n            if (bookingModalElement && !bookingModalElement.contains(event.target)) {\n                this.cancelBooking();\n            }\n        },\n\n        confirmBooking(bookingDetails) {\n            console.log('Booking Confirmed:', bookingDetails);\n            this.isBookingModalOpen = false;\n        },\n        cancelBooking() {\n            this.isBookingModalOpen = false;\n        }\n    },\n    watch: {\n        isBookingModalOpen(newValue) {\n            if (newValue) {\n                this.$nextTick(() => {\n                    window.addEventListener('click', this.handleDocumentClick);\n                });\n            } else {\n                window.removeEventListener('click', this.handleDocumentClick);\n            }\n        },\n    },\n};\n</script>\n\n<style>\ntable {\n    outline: 1px solid black;\n    outline-offset: 2px;\n    width: 100%;\n    max-width: 1000px;\n    table-layout: fixed;\n}\n\ntd {\n    border: 1px solid black;\n    padding: 3px;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n    position: relative;\n}\n\nth {\n    border: 1px solid black;\n    padding: 3px;\n}\n\n.search-form-area {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    background-color: rgb(28, 48, 79);\n}\n\n.info {\n    display: flex;\n    flex-direction: row;\n    justify-content: center;\n}\n\n.info p {\n    padding: 10px;\n}\n\n.big-div {\n    justify-content: center;\n    margin-bottom: 20px;\n}\n\n.table-div {\n    display: flex;\n    justify-content: center;\n}\n\n.sorting-options {\n    display: flex;\n    justify-content: center;\n    margin-bottom: 20px;\n}\n\n.filtering-options {\n    display: flex;\n    justify-content: center;\n    margin-bottom: 20px;\n    align-items: center;\n}\n\n.user-options {\n    display: flex;\n    justify-content: center;\n}\n</style>\n"]}]}